# 이커머스 API 기능 명세서

## 개요
본 문서는 HHPlus 이커머스 플랫폼의 핵심 기능 10개에 대한 요구사항을 정의합니다.

---

## 1. 상품 관리 (3개)

### 1.1 상품 목록 조회
**기능**: 판매 중인 전체 상품 목록을 조회합니다.

**목적**: 고객이 구매 가능한 상품을 탐색할 수 있도록 합니다.

**API**: `GET /api/goods`

**주요 요구사항**:
- 모든 상품의 기본 정보(상품명, 가격, 재고 여부)를 반환
- 페이징 처리 지원

---

### 1.2 상품 상세 조회
**기능**: 특정 상품의 상세 정보와 옵션(색상, 사이즈 등)을 조회합니다.

**목적**: 고객이 상품의 구체적인 옵션과 가격 정보를 확인하고 선택할 수 있도록 합니다.

**API**: `GET /api/goods/{gid}`

**주요 요구사항**:
- 상품 기본 정보 및 옵션별 재고 상태 제공
- 존재하지 않는 상품 조회 시 404 오류 반환 (P001)

---

### 1.3 인기 상품 조회
**기능**: 최근 일정 기간 내 판매량 기준 상위 N개 상품을 조회합니다.

**목적**: 고객에게 인기 상품 정보를 제공하여 구매 의사결정을 돕습니다.

**API**: `GET /api/goods/popular?days=3&limit=5`

**주요 요구사항**:
- 조회 기간 및 결과 개수를 쿼리 파라미터로 지정
- 판매량 기준 내림차순 정렬

---

## 2. 장바구니 (3개)

### 2.1 장바구니 담기
**기능**: 선택한 상품 옵션을 장바구니에 추가합니다.

**목적**: 고객이 구매를 원하는 여러 상품을 임시 저장할 수 있도록 합니다.

**API**: `POST /api/cart`

**주요 요구사항**:
- 재고 수량 확인 후 추가 (재고 부족 시 400 오류 - P002)
- 사용자별 장바구니 관리

---

### 2.2 장바구니 조회
**기능**: 사용자의 장바구니에 담긴 상품 목록을 조회합니다.

**목적**: 고객이 담아둔 상품과 예상 총 금액을 확인할 수 있도록 합니다.

**API**: `GET /api/cart?uid={uid}`

**주요 요구사항**:
- 상품명, 옵션명, 수량, 단가, 소계 정보 제공
- 총 예상 금액 계산

---

### 2.3 장바구니 항목 삭제
**기능**: 장바구니에서 특정 항목을 제거합니다.

**목적**: 고객이 불필요한 상품을 장바구니에서 제거할 수 있도록 합니다.

**API**: `DELETE /api/cart/{cid}`

**주요 요구사항**:
- 존재하지 않는 장바구니 항목 삭제 시 404 오류 반환 (CART001)
- 삭제 성공 시 204 No Content 반환

---

## 3. 주문/결제 (2개)

### 3.1 주문 생성
**기능**: 장바구니 상품을 기반으로 주문을 생성하고 재고를 차감합니다.

**목적**: 결제 전 주문 정보를 확정하고 재고를 예약합니다.

**API**: `POST /api/order`

**주요 요구사항**:
- 재고 확인 및 차감 (재고 부족 시 400 오류 - P002)
- 쿠폰 할인 적용 (선택 사항)
- Pessimistic Lock을 통한 동시성 제어
- 주문 상태: PENDING

---

### 3.2 주문 결제
**기능**: 잔액 또는 결제 수단을 이용하여 주문을 결제 처리합니다.

**목적**: 결제를 완료하고 주문 상태를 확정합니다.

**API**: `POST /api/order/{oid}/pay`

**주요 요구사항**:
- 주문 존재 여부 확인 (없으면 404 오류 - O002)
- 잔액 확인 및 차감 (부족 시 402 오류 - PAY001)
- 결제 기록 생성
- Pessimistic Lock을 통한 잔액 동시성 제어

---

## 4. 쿠폰 (2개)

### 4.1 쿠폰 발급
**기능**: 선착순 쿠폰을 사용자에게 발급합니다.

**목적**: 고객이 주문 시 할인 혜택을 받을 수 있도록 합니다.

**API**: `POST /api/coupon/{cid}/issue`

**주요 요구사항**:
- 쿠폰 잔여 수량 확인 (소진 시 409 오류 - C001)
- 발급 수량 원자적 증가
- Pessimistic Lock을 통한 선착순 동시성 제어
- 사용자 쿠폰 상태: ACTIVE

---

### 4.2 내 쿠폰 조회
**기능**: 사용자가 보유한 쿠폰 목록을 조회합니다.

**목적**: 고객이 사용 가능한 쿠폰을 확인하고 주문에 적용할 수 있도록 합니다.

**API**: `GET /api/coupon/my?uid={uid}&state=ACTIVE`

**주요 요구사항**:
- 쿠폰 상태별 필터링 지원 (ACTIVE, USED, EXPIRED)
- 쿠폰 상세 정보 (쿠폰명, 할인 금액/비율, 유효기간) 제공

---

## 비기능 요구사항

### 동시성 제어
- 재고 차감 (주문 생성)
- 쿠폰 발급 (선착순)
- 잔액 차감 (결제)

위 작업들은 **Pessimistic Lock (FOR UPDATE)**을 통해 동시성을 제어합니다.

### 에러 처리
모든 API는 표준화된 에러 코드와 메시지를 반환합니다.
- P001, P002: 상품 관련
- O001, O002: 주문 관련
- PAY001, PAY002: 결제 관련
- C001-C004: 쿠폰 관련
- CART001: 장바구니 관련
